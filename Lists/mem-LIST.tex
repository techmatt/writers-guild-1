%%%%%
%%
%% This file sets up the Mem, MemFold, and MemEnvelope datatypes, and
%% creates possible macros for each.
%%
%% The Mem datatype isn't really used directly; it's there so the
%% other datatypes can inherit and share its code.
%%
%%%%%

\DECLARESUBTYPE{Mem}{Element}
\PRESETS{Mem}{
  %% \MYname is the trigger
  \F\MYtext	%%  text
  }


%%%%%
%% MemFold and MemEnvelope are both subtypes of Mem.  MemFold is for
%% fold-n-staple style mempackets, MemEnvelope is for stuff-n-seal
%% style mempackets.  If you want a mempacket to contain interesting
%% contents, like sheets, abilities, and other mempackets, use a
%% MemEnvelope.
\DECLARESUBTYPE{MemFold}{Mem}
\DECLARESUBTYPE{MemEnvelope}{Mem}


%%%%%
%% MemCover and MemPage are for the cover and pages of mempacket
%% booklets, which resemble research notebooks.  These are good
%% substitutes for large piles of MemFolds, and can be useful for
%% things like amnesiac characters.
%%
%% Like MemFolds, MemPages shouldn't directly own any other elements
%% as contents.  Use MemEnvelope instead.
%%
%% MemPages are usually assigned to a MemCover (via \MYmems), with the
%% MemCover representing the entire booklet and assigned to a
%% character.
%%
%% A MemCover is not a mempacket in and of itself; its name is not its
%% trigger and its text is not a memory.
\DECLARESUBTYPE{MemCover}{Mem}
\PRESETS{MemCover}{
  \sd\MYtext	{Each page is a memory/event packet with a separate
		trigger.}
  }

\DECLARESUBTYPE{MemPage}{Mem}


%%%%%
%% \memfold{<trigger>}{<text>}
%% \memenvelope{<trigger>}{<text>}
%% \memcover{<name>}{<pages>}
%% \mempage{<trigger>}{<text>}
%% \startmembook{<name>} <pages> \endmembook
%%
%% These are wrappers around \INSTANCE, useful as 1-shots.
%% \startmembook...\endmembook is a simple wrapper around \memcover
%% that may have better syntax for use within character sheets (inside
%% a \starttag{mems}...\endtag block).
\newinstance{MemFold}{\memfold[2]}{
  \s\MYname{#1}\s\MYtext{#2}}
\newinstance{MemEnvelope}{\memenvelope[2]}{
  \s\MYname{#1}\s\MYtext{#2}}
\newinstance{MemCover}{\memcover[2]}{
  \s\MYname{#1}\s\MYmems{#2}}
\newinstance{MemPage}{\mempage[2]}{
  \s\MYname{#1}\s\MYtext{#2}}

\long\def\startmembook#1#2\endmembook{\memcover{#1}{#2}}


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\NEW{MemFold}{\mTest}{
  \s\MYname	{Test Trigger}
  \s\MYtext	{This is a Test of a fold-n-staple memory packet}
  }
  
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\NEW{MemCover}{\mStress}{
  \s\MYname     {Stress}
  \s\MYmems     {\mStressTime{},\mStressMSOne{},\mStressMSTwo{},\mStressEarthOne{},\mStressEarthTwo{},\mStressMSThree{},\mStressRetape{},
  			  \mStressExtreme{}, \mStressGotRetaped{}}
} 


\NEW{MemPage}{\mStressTime}{
  \s\MYname     { Open two hours into game }
  \s\MYtext     { This conference is exciting, and you're having a blast.  However, it's still pretty tiring.  The effort of keeping going and dealing with all these people is somewhat stressful. }
  }

\NEW{MemPage}{\mStressMSOne}{
  \s\MYname     { Open when you see badge number MADSCIENTIST }
  \s\MYtext     { You recognize this \cMS{\human}, but you're not sure why. }
  }

\NEW{MemPage}{\mStressMSTwo}{
  \s\MYname     { Open if you talk to badge number MADSCIENTIST for at least three minutes }
  \s\MYtext     { You feel both fear and a strange sense of obedience to this person, but you still can't remember where you have met before. }
  }

\NEW{MemPage}{\mStressEarthOne}{
  \s\MYname     { Open when you see an earth elemental }
  \s\MYtext     { You haven't been working with earth elementals very much lately, but now that you've seen one, you get the bad feeling like you have had more interactions with them than you can remember. }
  }

\NEW{MemPage}{\mStressEarthTwo} {
  \s\MYname     { Open if you interact with badge number MINION }
  \s\MYtext     { You feel a strange compulsion to take control of this elemental.  You issue a command to \cMinion{\them}, appropriate to the current situation.  If there are no immediately relevant commands, ask \cMinion{\them} to make you a sandwich.  The compulsion passes after you have made this command.  Obviously, this involuntary break in your self-control is distressing.  Roleplay accordingly. }
  }

\NEW{MemPage}{\mStressMSThree} {
  \s\MYname     { Open if you interact with badge number MADSCIENTIST for a total of at least ten minutes  }
  \s\MYtext     { Your continued interaction with \cMS{} has triggered some kind of flashback.  

During the flashback, you are not aware of what is going on around you.  Stand still, eyes glazed, and unresponsive to outside stimuli, for two minutes.  (You are effectively Knocked Out, even though you have not collapsed.) }
  }

\NEW{MemPage}{\mStressRetape} {
  \s\MYname     { Open if you hear anyone suggest forceful or dangerously fast retaping }
  \s\MYtext     { Hell no!  You are distressed by the mere suggestion of such a thing.  You should object loudly and immediately. }
}
   
\NEW{MemPage}{\mStressExtreme} {
  \s\MYname     { Open if you have had a flashback and also have experienced at least two stressful events }
  \s\MYtext     { That was the last straw.  The excess stress at this event has gotten to you.  You are extremely anxious and jittery for the remainder of the conference.  Your fear of \cMS{} will cause you to flee from any room \cMS{\they} enters.  Further, you think that elementals will obey your every command.  Roleplay accordingly. }
}

\NEW{MemPage}{\mStressGotRetaped} {
  \s\MYname     { Open if someone succeeds in retaping you }
  \s\MYtext     { Well, they've succeeded in retaping you, but there are some unintended side effects.  You will follow orders, and be generally obedient to your new supervisor, 
  but you are also now permanently insane and psychotic.  Feel free to take orders too literally (like a tricky genie might).  Further, you should also take every 
  opportunity to screw up everything for everybody.  If you can find a way to cause a war or destroy the world, go for it.  Any ongoing or future consequences of stressful events have no further effect on 
  your mental status. }
}

\NEW{MemFold}{\mGDCollaboration}{
  \s\MYname	{C Packet}
  \s\MYtext	{From your conversation, you've made some deductions about what \cGD{} is working on. The device she is working with is an electromagnet that is capable of attracting elementals. It is a very potent device and, with a strong enough power source, it might even be able to pull them in over vast distances. You suspect it is designed to be hooked up to the Conduit.}
  }
  
\NEW{MemFold}{\mGDExperiment}{
  \s\MYname	{E Packet}
  \s\MYtext	{You feel yourself drawn towards the strange torus. Initially the effect is quite subtle, but all of a sudden you are shot forward with alarming intensity. You then find yourself *inside* the strange device, staring back at yourself. When \cGD{} disables the device, you rapidly retreat to your physical body, but the experience is still extremely disorienting. Your CR is reduced by 1 for the next three minutes.}
  }
  
  \NEW{MemFold}{\mSciTaste}{
  \s\MYname	{W Packet}
  \s\MYtext	{This substance tastes like ambrosia. It somehow reminds you of a distant home, and you feel empowered by this connection. For the next 10 minutes, your CR is increased by 1. You also feel a positive connection towards the person who gave this to you.}
  }
  
    \NEW{MemFold}{\mSciBigTaste}{
  \s\MYname	{X Packet}
  \s\MYtext	{This substance tastes \emph{amazing}. You feel like you are a primal elemental sitting in the middle of the elemental planes. For the next 10 minutes, your CR is increased by 1. If the person who gave this to you is a human, you feel a very strong and positive connection towards them, as if they were a long-lost mentor. You can no longer enslave them, and you cannot attack them unless strongly provoked.}
  }
  
%%Trigger to Air King that he is probably willing to sign a treaty at this point
\NEW{MemFold}{\mWhiteTech}{
  \s\MYname	{Open if you receive item number \iWhite{\MYnumber{}} from a human.}
  \s\MYtext	{Can humans manufacture this substance? If so, it is critical that you protect this source and keep it out of the hands of the other elementals. This technology is worth signing a treaty over.}
  }